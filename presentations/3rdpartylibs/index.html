<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Third Party Libraries: The Dark Side</title>

	<link rel="stylesheet" href="../../css/reveal.css">
	<link rel="stylesheet" href="../../css/theme/first8.css">
	<link rel="stylesheet" href="../../css/theme/newspaper.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="../../lib/css/zenburn.css">

	<link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900,400italic,700italic,900italic|Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

	<style>
		.reveal section img {
			border: 0px;
			box-shadow: 0 0 0px;
		}
	</style>

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? '../../css/print/pdf.css' : '../../css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">

			<section>
				<img class="plain" src="./images/teqnation.png" />
			</section>

			<section class="title">
				<h1>Third Party Libraries</h1>
				<h2>The Dark side</h2>
				<p>
					Slides: https://first8.nl<br>
					https://bit.ly/2KfFSX8
				</p>


				<aside class="notes">
					Welcome all and thanks for joining my talk on the Dark side of third party libraries.

					The slides can be found at the bit.ly link and, probably from tomorrow onwards on the First8 site as well.
				</aside>
			</section>

			<section>
				<section class="introduction">
					<div>
						<div class="text">
							<h1>Hello!</h1>
							<h2>I am Arjan Gelderblom</h2>
							<p>You can find me at
								<div class="twitter">@ragelderblom</div>
								<div>a.gelderblom@first8.nl</div>
							</p>
						</div>
						<div class="image">
							<img src="./images/profile.jpg" />
						</div>
					</div>

					<aside class="notes">
						My name is Arjan Gelderblom and I'm a Security Software Engineer, which basicly means that I'm the developer
						on security teams and the security guy on the development teams. But I try to be the glue between the two, so
						that in the end both teams can work together.

						<br><br> You can reach me on twitter and by email for questions you have.
					</aside>
				</section>

				<section class="big-image" data-background="./images/first8-lego.jpg">
					<aside class="notes">
						I work at First8, where we build cool stuff like Milenium Falcons from Lego, but that is outside of business hours.
						Within those bysiness hours we are do Java consultancy.<br>
            DevSecOps<br>
            Spring<br>
            Java EE<br>
            Kubernetes / OpenShift / Docker<br>
					</aside>
				</section>

				<section class="big-image" data-background="./images/joa-profile.jpg">
					<aside class="notes">
						But above all I'm a husband and proud father.
					</aside>
				</section>

			</section>

			<section>
				<section class="transition">
					<h1>Third Party Library Security</h1>
					<h2>Introduction</h2>
				</section>

				<section class="newspaper">
					<div class="head">
						<div class="headerobjectswrapper">
							<div class="weatherforcastbox">
								<span style="font-style: italic;">Weatherforcast for the next 24 hours: Plenty of Sunshine</span><br>
								<span>Wind: 18km/h; Ther: 13°C; Hum: 66%</span>
							</div>
							<header>TEQNation</header>
						</div>
						<div class="subhead">Utrecht - Wednesday April 25, 2018</div>
					</div>

					<div class="content">
						<div class="collumns">

							<div class="collumn">
								<div class="head"><span class="headline hl3">Equifax Says Cyberattack May Have Affected 143 Million in the U.S.</span>
									<p><span class="headline hl4">by NEW YORK TIMES</span></p>
								</div>
								Equifax, one of the three major consumer credit reporting agencies, said on Thursday that hackers had gained access to company data that potentially compromised sensitive information
								for 143 million American consumers, including Social Security numbers and driver’s license numbers.
								<p>The attack on the company represents one of the largest risks to personally sensitive information in recent years, and is the third major cybersecurity threat for the agency since 2015.</p>
								<p>Equifax, based in Atlanta, is a particularly tempting target for hackers. If identity thieves wanted to hit one place to grab all the data needed to do the most damage, they would go straight to one of the three major credit reporting agencies.</p>
								<p><span class="citation">“This is about as bad as it gets,”</span>said Pamela Dixon, executive director of the World Privacy Forum, a nonprofit research group.
									“If you have a credit report, chances are you may be in this breach. The chances are much better than 50 percent.</p>
								<p>Criminals gained access to certain files in the company’s system from mid-May to July by exploiting a weak point in website software, according to an investigation by Equifax and security consultants. The company said that it discovered the
									intrusion on July 29 and has since found no evidence of unauthorized activity on its main consumer or commercial credit reporting databases.</p>
								<p>
							</div>

							<div class="collumn">
								<div class="head"><span class="headline hl5">That Yahoo data breach actually hit three billion accounts</span>
									<p><span class="headline hl6">by WIRED</span></p>
								</div>
								Yahoo originally claimed that one billion accounts were accessed by hackers. Now it's admitted it was actually three billion.
								<p>Last year, Yahoo admitted it had been hacked three years previously, leaking account details of one billion of its three billion users, making it one of the biggest breaches of all time. Now, Yahoo has admitted that all
									three billion accounts were actually accessed.</p>
								<p>The revelation follows Yahoo's acquisition by Verizon, with an investigation by forensic security experts during the company's integration revealing that all Yahoo user accounts were affected by the hack.</p>

							</div>

							<div class="collumn">
								<div class="head"><span class="headline hl1">Deloitte hit by cyber-attack revealing clients’ secret emails</span>
									<p><span class="headline hl2">by THE GUARDIAN</span></p>
								</div>
								One of the world’s “big four” accountancy firms has been targeted by a sophisticated hack that compromised the confidential emails and plans of some of its blue-chip clients, the Guardian can reveal.
								<p>Deloitte, which is registered in London and has its global headquarters in New York, was the victim of a cybersecurity attack that went unnoticed for months.</p>
								<p>One of the largest private firms in the US, which reported a record $37bn (£27.3bn) revenue last year, Deloitte provides auditing, tax consultancy and high-end cybersecurity advice to some of the world’s biggest banks, multinational companies,
									media enterprises, pharmaceutical firms and government agencies.</p>
								<p>The Guardian understands Deloitte clients across all of these sectors had material in the company email system that was breached. The companies include household names as well as US government departments.</p>
								<p>So far, six of Deloitte’s clients have been told their information was “impacted” by the hack. Deloitte’s internal review into the incident is ongoing. </p>
								<p>The Guardian understands Deloitte discovered the hack in March this year, but it is believed the attackers may have had access to its systems since October or November 2016.</p>
								<p>The hacker compromised the firm’s global email server through an “administrator’s account” that, in theory, gave them privileged, unrestricted “access to all areas”.</p>
								<p>The account required only a single password and did not have “two-step“ verification, sources said.</p>

							</div>

							<div class="collumn">
								<div class="head"><span class="headline hl3">Verizon data of 6 million users leaked online</span>
									<p><span class="headline hl4">by CNNTECH</span></p>
								</div>
								Verizon confirmed on Wednesday the personal data of 6 million customers has leaked online.
								<p>The security issue, uncovered by research from cybersecurity firm UpGuard, was caused by a misconfigured security setting on a cloud server due to "human error." </p>
								<p>The error made customer phone numbers, names, and some PIN codes publicly available online. PIN codes are used to confirm the identity of people who call for customer service. </p>
								<p>No loss or theft of customer information occurred, Verizon told CNN Tech. </p>
								<p>UpGuard -- the same company that discovered leaked voter data in June -- initially said the error could impact up to 14 million accounts. </p>
								<p>Chris Vickery, a researcher at UpGuard, discovered the Verizon data was exposed by NICE Systems, an Israel-based company Verizon was working with to facilitate customer service calls. The data was collected over the last six months. </p>
								<p>Vickery alerted Verizon to the leak on June 13. The security hole was closed on June 22. </p>
								<p>The incident stemmed from NICE security measures that were not set up properly. The company made a security setting public, instead of private, on an Amazon S3 storage server -- a common technology used by businesses to keep data in the cloud.
									This means Verizon data stored in the cloud was temporarily visible to anyone who had the public link. </p>
							</div>

							<div class="collumn">
								<div class="head"><span class="headline hl1">Popular video-encoding Mac app HandBrake compromised with malware</span>
									<p><span class="headline hl4">by TECHRADAR</span></p>
								</div>
								The creators of media transcoding program HandBrake have issued a statement warning that certain downloads of the installer for the Mac version of the app may contain a Trojan virus.
								<p>Downloading the app between May 2 (14:30 UTC) and May 6 (11:00 UTC) from the “download.handbrake.fr” mirror means you have a 50-percent chance of being infected with the Trojan. Automatically updated apps (using updater version 1.0 and above),
									and files downloaded from the primary mirror are unaffected.</p>
								<p>The attackers replaced the usual HandBrake installer file, titled ‘HandBrake-1.0.7.dmg’, with a version that also contained the Trojan virus, so checking if you have this file on your system and seeing when it was downloaded is the first step to
									identifying the threat.</p>
								<p>If you have downloaded the installer during the specified time window, you can check if you’ve inadvertently installed the malware by opening your Mac’s Activity Monitor application and seeing if you have a process called “Activity_agent”.
									If so, you are infected.</p>
								<p>
							</div>
						</div>
					</div>

					<aside class="notes">
						As you can see we all need security. Otherwise somewhere on some level something goes wrong. And for these company it meant major headlines. But we don't hold any sensitive data about
						our customers so we can't have any data leaks from that.

						<br><br> As you can see Handbrake which is a video-encoding app for Mac got compromised and infected with malware. So altough they didn't steal data directly from that commpany they still
						made handlines with a security incident.

						<br><br>But we do not have a product either so we are not vulnerable to that either. Ok... whatever it might be that you are doing then... you still got your reputation. Altough
						phising just recently got passed by Cryptoware as most lucrative form of cybercrime it is still lucrative to have a reputable website serving your phising mails and other
						nefarious content.
					</aside>
				</section>

				<section>
					<h2>Spring Boot - Rest Service</h2>
					<pre><code class="hljs" data-trim contenteditable style="max-height: 100%">
package nl.first8.presentations.spring.helloworld;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@EnableAutoConfiguration
public class HelloController {

    @RequestMapping("/")
    @ResponseBody
    public String index() {
        return "Hello world!";
    }

    public static void main(String[] args) {
        SpringApplication.run(HelloController.class, args);
    }
}
					</code></pre>
					<h3>A whopping 22 lines of code</h3>

					<aside class="notes">
						But what about the code you do not write yourself? As you can see this application has 22 lines of code written to be
						functional and is working fine. It is a REST service that will respond with "Hello World" when called. Sorry but my examples
						are based on Java because that is still my background.

						<br><br>Who want to take a guess on the number of lines that the dependencies consist of?

						<br><br>But what you can't see is that 875.000 lines of Java code (980.000 lines total) that are imported via third party libraries that you didn't write.
						How secure are those?

						<br><br>But I'm using open source...
					</aside>
				</section>

				<section class="quote">
					<blockquote>Given enouqh eyeballs, all bugs are shallow.<div class="author">- Linus Torvalds</div></blockquote>

					<aside class="notes">
						The misconception about open source being more secure started with what's known as Linus Law - named in honor of Linus
						Torvalds and formulated by Eric S. Raymond in his essay and book The Cathedral and the Bazaar - and Linus' famous quote.

						<br><br>Considering that a bug such as ShellShock (September 2014) existed in the OpenSSL library for more than 22 years, it is far
						from relevant nowadays.
					</aside>
				</section>


			</section>

			<section>
				<section class="transition">
					<h1>Known Vulnerabilities</h1>
					<h2>Introduction</h2>
				</section>

				<section>
					<img src="images/krack-attack.jpg" />

					<aside class="notes">
						Anyone heard of this one?<br>pause<br> This is the KRACK attack published in 2017. This one got pretty heavy media coverage in 2017.
						But in 2017 20.000 vulnerabilites where disclosed.
					</aside>
				</section>

				<section>
					<h2>Common OSS vulnerabilities (2017)</h2>
					<ul>
						<li>CVE-2016-9879 : Spring Security Framework</li>
						<li>CVE-2017-7525 : Jackson Databind</li>
						<li>WS-2017-0195 : jQuery</li>
						<li>CVE-2017-5637 : Zookeeper Apache</li>
						<li>CVE-2017-12617 : Apache Tomcat</li>
					</ul>

					<aside class="notes">
						So altough bugs like Heartbleed, Shellshock and the DROWN attack made headlines that were too big to ignore, most bugs in dependencies
						often go unnoticed.

						<ul>
							<li>Allowed attackers to bypass an important security constraints</li>
							<li>Deserialization flaw which could allow an unauthenticated user to perform code execution.</li>
							<li>In < version 2.2.4 lowercasing logic on attribute names could lead to infinite recursion and potentially denial of service</li>
							<li>Possible Denial of Service attack.</li>
							<li>Allowing potiential remote execution attack.</li>
						</ul>

						These are just some of the more common ones found in 2017. So by far not a complete list.

					</aside>
				</section>

				<section class="transition">
					<h1>Known Vulnerabilities</h1>
					<h2>Migitation</h2>
				</section>

				<section class="default">
					<h2>OWASP Top 10</h2>
					<h3>A9: Using components with Known Vulnerabilities</h3>

					<aside class="notes">
						OWASP recognized this problem and added "Using Components with Known Vulnerabilities" to the OWASP Top 10 back in 2013. It is still
						so prevelant that it made the 2017 list again.

						But not only OWASP recognized this problem; different open-source and commercial tools have emerged over the years to tackle this problem.
					</aside>
				</section>

				<section>
					<h1>Tools</h1>
					<table>
						<th>
							<td><b>Open Source</b></td>
							<td><b>Commercial</b></td>
						</th>
						<tr>
							<td></td>
							<td>Node Security Project</td>
							<td>Hakiri</td>
						</tr>
						<tr>
							<td></td>
							<td>RetireJS</td>
							<td>Snyk</td>
						</tr>
						<tr>
							<td></td>
							<td>OSSIndex</td>
							<td>Gemnasium</td>
						</tr>
						<tr>
							<td></td>
							<td>Dependency-check</td>
							<td>SRC:CLR</td>
						</tr>
						<tr>
							<td></td>
							<td>Bundler-audit</td>
							<td></td>
						</tr>
					</table>

					<aside class="notes">
						The Node Security Project is known for its work on Node.js modules and NPM dependencies.
						It also provides tools that scan for dependencies and find vulnerabilities using public vulnerability
						databases as well as its own database, which it builds from the scans it does on NPM modules.

						<br><br>RetireJS is an open-source, JavaScript-specific dependency checker. The project is primarily focused on ease of use.

						<br><br>OSSIndex supports several technologies. It extracts dependency information from NPM, Nuget, Maven Central Repository, Bower,
						hocolatey, and MSI (which means it's covering the JavaScript, .NET/C#, and Java ecosystems)

						<br><br>Dependency-check is an open-source command line tool from OWASP that is very well maintained. It can be used in a stand-alone mode as well as in
						build tools. Dependency-check supports Java, .NET, JavaScript, and Ruby.

						<br><br>Bundler-audit is an open-source, command-line dependency checker focused on Ruby Bundler.
						This project retrieves its vulnerability information from the NIST NVD and RubySec, which is a Ruby vulnerability database.

						<br><br>Hakiri is a commercial tool that offers dependency checking for Ruby and Rails-based GitHub projects using static code analysis.
					 	It offers free plans for public open-source projects and paid plans for private projects

						<br><br>Snyk is a commercial service that focuses on JavaScript npm dependencies.

						<br><br>Gemnasium is a commercial tool which supports Ruby, NPM (JavaScript), PHP, Python, and Bower (JavaScript)

						<br><br>Source Clear is a commercial tool. It offers a ton of plugins to several IDEs, deployment systems, and source repositories, as well as a command-line interface.

						<br><br>As you can see a lot of options to choose from...
					</aside>
				</section>

				<section>
					<h1>Example</h1>
    			<iframe src="https://asciinema.org/a/uaRi8eep5sUBmzKcFa2Csyqxu/embed?cols=200&rows=30&speed=2&size=medium"
              style="width: 1328px; height: 706px;"></iframe>

							<aside class="notes">
								This is a manual run off the OWASP dependecy check on the Hello World rest application.
								<br>As you can see it finds some errors and fails the build...
							</aside>
				</section>

			</section>

			<section>
				<section class="transition">
					<h1>Cross Build Injection (XBI)</h1>
				</section>

				<section>
					<img src="images/mitm-nexus.jpg">

					<aside class="notes">
						Another example from the Java world. We have a Jenkins build server and a Nexus artifact repository.

						How we are comprised isn't really part of this. But our Jenkins has been comprised and is communicating with the
						attacker instead of the Nexus he is expecting. The attacker is now able to have our build use his compromised
						dependencies, which could do all kinds of nasty things.

						Depending on the level of knowledge he could further compromise the Jenkins machine by having a specific payload
						sent to you. Or he could compromise your 'customers', by having a keylogger in the dependency that steals creditcard
						information.
					</aside>
				</section>

				<section class="big-image" data-background="./images/https-url.jpg">
					<aside class="notes">
						Treat your build environment as a production environment. That it's only running internally isn't a excuse
						to not treat it like that. So have it only accessable by HTTPS and do all the other normal precautions you
						have when it is production.
					</aside>
				</section>

				<section>
					<img src="images/mitm-mvn-central.jpg">

					<aside class="notes">
						But what if they, by DNS hijacking or anything else, compromised your path to Maven Central. Then all the previous mentioned risks
						are back again. And there is nothing you can do on the infrastructure and/or server level to prevent this.

						Another option is that a author decides to withdraw his packages from the central repository. This isn't just theoratical as it happened
						to NodeJS. An author removed his 9 packages, and other people then reuploaded those packages and in least one case it did something completely
						different as the original package.
					</aside>
				</section>

				<section>
					<h1>Tools</h1>
					<ul>
						<li>nuget</li>
						<li>mvn pgpverify</li>
						<li>mvn dependencies</li>
						<li>pkgsign sign</li>
					</ul>

					<aside class="notes">
						what we then need is a way to verify that the artifact sent to us is the one we expect it to be. Luckely for this also tools are available
						to help us with this.

						For .Net the NuGet cli has a verify option that we can give a known fingerprint to compare to the one of the downloaded dependency.

						Maven supports the signing of packages which can then be verified by the pgpverify plugin. Only not all packages have this information in Maven Central
						, even some big ones, therefor we can't really rely on this. Therefor we can use the mvn dependencies plugin that wil generate a list of checksums we can
						then compare and fail the build if they differ.

						PKGsign is the NodeJS version of this. But just as the pgpverify of maven it is the author who has to sign the package. Therefor this isn't watertight as
						it might be possible that your are using a completely valid dependency that isn't signed by the author.

					</aside>
				</section>

				<section>
					<h1>Example</h1>
    			<iframe src="https://asciinema.org/a/HNl6J8oRfsR0Js6fD6ZLY3qjd/embed?cols=200&rows=30&speed=1&size=medium"
              style="width: 1328px; height: 706px;"></iframe>
				</section>

			</section>

			<section>
				<section class="transition">
					<h1>Unknown Vulnerabilities</h1>
					<h2>Introduction</h2>
				</section>

				<section>
					<h1>bugs</h1>

					<table>
						<th>
							<td>1k lines</td>
						</th>
						<tr>
							<td>Industry standard</td>
							<td class="fragment">15-50</td>
						</tr>
						<tr>
							<td>Microsoft</td>
							<td class="fragment">10-20 (0.5)</td>
						</tr>
						<tr>
							<td>Harlan Mills</td>
							<td class="fragment">3 (0.1)</td>
						</tr>
						<tr>
							<td>NASA</td>
							<td class="fragment">0</td>
						</tr>
					</table>

					<aside class="notes">
							Steve McConnell mentioned in his book Code Complete the following numbers about bugs (not vulnerabilities) per 1000 LOC.

							<br><br>Industry Average: "about 15 - 50 errors per 1000 lines of delivered code." He further says this is usually representative
							of code that has some level of structured programming behind it, but probably includes a mix of coding techniques.

							<br><br>Microsoft Applications: "about 10 - 20 defects per 1000 lines of code during in-house testing, and 0.5 defect per
							KLOC (KLOC IS CALLED AS 1000 lines of code) in released product (Moore 1992)." He attributes this to a combination of code-reading
							techniques and independent testing.

							<br><br>Harlan Mills pioneered 'cleanroom development', a technique that has been able to achieve rates as low as 3 defects per 1000 lines
							of code during in-house testing and 0.1 defect per 1000 lines of code in released product

							<br><br>A few projects - for example, the space-shuttle software - have achieved a level of 0 defects in 500,000 lines of code using
							a system of format development methods, peer reviews, and statistical testing."

							<br><br>NOTICE these are bugs and not vulnerabilities.
					</aside>
				</section>

				<section class="transition">
					<h1>Unknown Vulnerabilities</h1>
					<h2>Migitation</h2>
				</section>

				<section class="big-image" data-background="./images/code-review.jpg" data-background-size="contain">
					<aside class="notes">
						It is almost impossible to start code reviewing your external libraries as well.. only for the really critical applications
						this might be a feasable option. Otherwise it would be completely out of proportions to review 875.000 lines for the 22 lines you
						wrote.
						<br><br>So what can we do....
					</aside>
				</section>

				<section class="big-image" data-background="./images/cast-nets.jpeg">
					<aside class="notes">
						Normally we want to keep the scope of everything as small as possible, but when it comes to security we want to cast our nets wide.

						If you have a library that is doing, let's say, sanitization of input for you; test it. Make sure it behaves as you expect it too,
						for example you can fuzzy test your input...

						And do not limit things like Penetration tests to your own code only, include as much as possible. If it is possible to break your application,
						the hacker won't mind if it is in a library or in your own code.
					</aside>
				</section>

				<section class="big-image" data-background="./images/apples.jpg">
					<aside class="notes">
						And ofcourse pick your dependencies carefully. Do you really need that fancy projecct as a dependency, or do you only need that
						small library that does exactly what you want and nothing more.

						Various  aspects  to  review:
						- Past  security  public  reports
						– Pentest  or  other  assessment  reports
						– CVE  and  other  databases  with  reports  on library
					 	– Security  email  list  activity  for  this  library
					</aside>
				</section>

			</section>

			<section>
				<section class="big-image" data-background="./images/post-apocalyptic.jpg">

					<aside class="notes">
						So inconclusion are we in a post-apocalyptic world where we should stop using third party libraries?

						Open source software has flaws and will have flaws, as any other software product we know of today. Most open source projects have in general
						good track records in addressing security issues quickly and professionally and providing fixed versions as soon as possible.

						Open source is great for development and there's lots of benefit, but there's also risks that organizations need to be aware of.
					</aside>
				</section>
			</section>

			<section>
				<img class="plain" src="./images/teqnation.png" />
			</section>
	</div>

	<script src="../../lib/js/head.min.js"></script>
	<script src="../../js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({

			width: "100%",
			height: "100%",
			margin: 0,
			minScale: 1,
			maxScale: 1,

			// your allotted time for presentation
			allottedTime: 45 * 60 * 1000, // 40 minutes
			progressBarHeight: 5,
			timeProgressBarStyle: 'speaker',

			dependencies: [{
					src: '../../plugin/markdown/marked.js'
				},
				{
					src: '../../plugin/markdown/markdown.js'
				},
				{
					src: '../../plugin/notes/notes.js',
					async: true
				},
				{
					src: '../../plugin/highlight/highlight.js',
					async: true,
					callback: function() {
						hljs.initHighlightingOnLoad();
					}
				},
				{
					src: '../../plugin/elapsed-time-bar/elapsed-time-bar.js'
				},
				{
					src: '../../plugin/fullscreen/fullscreen.js'
				},
				{
					src: '../../plugin/embed-tweet/embed-tweet.js'
				}
			]
		});
	</script>
</body>
